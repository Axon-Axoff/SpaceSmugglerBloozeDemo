<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
  <title>Space Smuggler Blooze</title>
  <style>
html, body, #canvas { margin:0; padding:0; border:0; }
body {
  color:white; background-color:black;
  overflow:hidden; touch-action:none;
}
#canvas { display:block; }
#canvas:focus { outline:none; }

#status, #status-splash, #status-progress {
  position:absolute; left:0; right:0;
}
#status, #status-splash { top:0; bottom:0; }
#status {
  background-color:#242424;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  visibility:hidden;
}
#status-splash { max-height:100%; max-width:100%; margin:auto; }
#status-progress, #status-notice { display:none; }
#status-progress { bottom:10%; width:50%; margin:0 auto; }
#status-notice {
  background-color:#5b3943; border-radius:0.5rem;
  border:1px solid #9b3943; color:#e0e0e0;
  font-family:'Noto Sans', Arial, sans-serif;
  line-height:1.3; margin:0 2rem;
  overflow:hidden; padding:1rem; text-align:center; z-index:1;
}

/* --- click overlay --- */
#fullscreen-overlay {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:radial-gradient(circle at center,#001010 0%,#000 100%);
  display:none; flex-direction:column; justify-content:center; align-items:center;
  color:#00ffaa; cursor:pointer;
  font-family:"Orbitron",sans-serif;
  z-index:9999; text-align:center;
}
#fullscreen-overlay h1 {
  font-size:3em; text-shadow:0 0 20px #00ffaa;
}
#fullscreen-overlay p {
  font-size:1.2em; color:#00ffcc; text-shadow:0 0 10px #00ffff;
}
  </style>

  <!-- ðŸ”„ PASTE FROM EXPORT: ICON LINKS -->
  <link rel="icon" type="image/png" href="index.icon.png" />
  <link rel="apple-touch-icon" href="index.apple-touch-icon.png" />
</head>

<body>
  <canvas id="canvas"></canvas>
  <noscript>Your browser does not support JavaScript.</noscript>

  <div id="status">
    <!-- ðŸ”„ PASTE FROM EXPORT: SPLASH IMAGE NAME -->
    <img id="status-splash" src="index.png" alt="">
    <progress id="status-progress"></progress>
    <div id="status-notice"></div>
  </div>

  <!-- Overlay shown after game loads -->
  <div id="fullscreen-overlay">
    <h1>ðŸš€ Space Smuggler Blooze</h1>
    <p>Click anywhere to start fullscreen</p>
  </div>

  <!-- ðŸ”„ PASTE FROM EXPORT: SCRIPT TAG -->
  <script src="index.js"></script>

  <script>
/* ðŸ”„ PASTE FROM EXPORT: GODOT_CONFIG block */
const GODOT_CONFIG = {"args":[],"canvasResizePolicy":1,"ensureCrossOriginIsolationHeaders":true,"executable":"index","experimentalVK":false,"fileSizes":{"index.pck":23428704,"index.wasm":43016933},"focusCanvas":true,"gdextensionLibs":[]};
/* END EXPORT BLOCK */

const GODOT_THREADS_ENABLED = true;
const engine = new Engine(GODOT_CONFIG);

(function () {
  const statusOverlay = document.getElementById('status');
  const statusProgress = document.getElementById('status-progress');
  const statusNotice = document.getElementById('status-notice');
  const fullscreenOverlay = document.getElementById('fullscreen-overlay');
  const canvas = document.getElementById('canvas');

  let initializing = true;
  let statusMode = '';

  function setStatusMode(mode) {
    if (statusMode === mode || !initializing) return;
    if (mode === 'hidden') {
      statusOverlay.remove();
      initializing = false;
      fullscreenOverlay.style.display = "flex";
      return;
    }
    statusOverlay.style.visibility = 'visible';
    statusProgress.style.display = mode === 'progress' ? 'block' : 'none';
    statusNotice.style.display = mode === 'notice' ? 'block' : 'none';
    statusMode = mode;
  }

  function setStatusNotice(text) {
    while (statusNotice.lastChild) statusNotice.removeChild(statusNotice.lastChild);
    text.split('\n').forEach(line => {
      statusNotice.appendChild(document.createTextNode(line));
      statusNotice.appendChild(document.createElement('br'));
    });
  }

  function displayFailureNotice(err) {
    console.error(err);
    const msg = err instanceof Error ? err.message :
                (typeof err === 'string' ? err : 'An unknown error occurred');
    setStatusNotice(msg);
    setStatusMode('notice');
    initializing = false;
  }

  // --- Godot startup ---
  const missing = Engine.getMissingFeatures({ threads: GODOT_THREADS_ENABLED });
  if (missing.length !== 0) {
    displayFailureNotice('Error\nMissing features:\n' + missing.join('\n'));
    return;
  }

  setStatusMode('progress');
  engine.startGame({
    onProgress(current, total) {
      if (current > 0 && total > 0) {
        statusProgress.value = current;
        statusProgress.max = total;
      } else {
        statusProgress.removeAttribute('value');
        statusProgress.removeAttribute('max');
      }
    },
  }).then(() => {
    setStatusMode('hidden');
  }, displayFailureNotice);

  // --- Fullscreen click handler ---
  async function goFullscreen() {
    fullscreenOverlay.style.display = "none";
    try {
      if (canvas.requestFullscreen) await canvas.requestFullscreen();
    } catch (e) {
      console.warn("Fullscreen denied:", e);
    }
  }
  fullscreenOverlay.addEventListener("click", goFullscreen);
  fullscreenOverlay.addEventListener("touchstart", e => {
    e.preventDefault(); goFullscreen();
  }, { passive: false });
})();
  </script>
</body>
</html>

